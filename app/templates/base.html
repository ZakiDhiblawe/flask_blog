<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flask Blog</title>
    <link rel="icon" href="{{ url_for('static', filename='images/ico.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-o0FX+AK3O+YH8G0H5gfFv8P0mIufgkxH5G6W5meMw/ZfFjZ2+j7c1BQ5j5Pml1xG5Xk5D3Jt2oW5wD+L35RPcA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .notifications {
            display: flex;
            flex-direction: column;
        }

        .card {
            border: none;
            border-radius: 10px;
            margin-bottom: 10px;
            /* Add some space between messages */
        }

        .sent {
            background-color: #007bff;
            color: rgb(241, 7, 7);
            align-self: flex-end;
        }

        .received {
            background-color: #f8d7da;
            color: black;
            align-self: flex-start;
        }

        .card-body {
            padding: 15px;
        }

        .seen-indicator {
            font-size: 20px;
        }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .card.sent {
            background-color: #13c2ee;
            /* Light blue for sent messages */
        }

        .card.received {
            background-color: #3be208;
            /* Light red for received messages */
        }

        .card.unread {
            border: 1px solid #000;
            /* Black border for unread messages */
        }

        .card.read {
            background-color: #fff;
            /* White background for read messages */
            border: 1px solid #ddd;
            /* Light gray border for read messages */
            color: black;
            /* Ensure text is visible on white background */
        }
    </style>
</head>

<body>
    {% if current_user.is_authenticated and current_user.username == 'zaki' %}
    {% include 'admin-nav.html' %}
    {% else %}
    {% include 'nav.html' %}
    {% endif %}

    <div class="container" style="margin-bottom: 50px;">
        {% block content %}
        {% endblock %}
        <footer>
            <div class="fixed-bottom" style="background-color: #86bbf7; height: 7%; margin-top: 5;">
                <b>
                    <center>2024 &copy; Zaki Dhiblaaw | All rights reserved</center>
                </b>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

        <script>
            function fetchUnreadCount() {
                fetch('/notification/unread_count')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('unread-count').textContent = data.unread_count;
                    });
            }
            
            function updateMessageStatus(notificationId, isRead) {
                fetch(`/notification/toggle_read_status/${notificationId}`, { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            fetchUnreadCount(); // Update unread count after changing status
                        }
                    });
            }
            
            // Initial fetch
            fetchUnreadCount();
            
            // Periodically update the unread count (e.g., every 10 seconds)
            setInterval(fetchUnreadCount, 60000);
            
            // Optionally, you can add event listeners to handle real-time message updates as well.
            </script>
           
</body>
<script>document.addEventListener('DOMContentLoaded', function() {
    // Detect user's time zone
    var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

    // Get CSRF token from meta tag
    var csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    // Send time zone to server
    fetch('/set-timezone', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({ timezone: timezone })
    });
});
</script>

</html>